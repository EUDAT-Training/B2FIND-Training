# Generation of metadata
Given metadata in raw form, e.g. as spreadsheet, extracted from other data or informal exchange, we need to convert this metadata to valid datasets that conform with standardized formats and schemas that can later be mapped to the common B2FIND schema.
<!--
This document describes how to generate such metadata records from spreadsheet (comma and tab-separated) files. 
-->

## Prerequisites

### 1. Python and the convert script
All functionality to convert spreadsheet data into well-formatted xml files is provided by the script [mdmanager.py](https://github.com/EUDAT-Training/B2FIND-Training/blob/master/mdmanager.py). 

### 2. Some samples of raw data
Some examples of 'raw metadata', i.e. comma and tabulator seperated lists,are given in the directory *samples/RAW_data*.
```sh
ls samples/RAW_data
annotations.tsv  sample.csv  smallData.tsv
```
At the moment this part is fully tested with the comma separated lists in the file ```sample.csv```.


## 1. Generate multiple XML files in batch mode

### Goal 
Create multiple XML files in the metadata format 'Dublincore' from a list of datasets given as comma separated values.

### Solution
For this part we use the python script `mdmanager.py` in the mode `g` and specify a source file by the option `-s SOURCE`. :

In the following we show how you can convert comma or tabular seperated files to valid XML files formated in the [DublinCore](http://dublincore.org/) metadata schema. 

### 1.2. Creation of a mapfile
In a first step we define the mapping of each field in the header line of the sample file
```sh
$ head -1 samples/RAW_data/sample.csv 
Common name,Scientific name,Location,Temperament,Diet,Water,Size,Region of the Aquarium,Breeding
```
to one of the DublinCore elements (see ```mapfiles/dcelements.txt```) or the DublinCore terms (see ```mapfiles/dcterms.txt```).

You are free by assigning the original fields to any one of the DublinCore fields. The only mandatory fields to set are ```dc:title``` and ```dc:identifier```, whereby the value of the latter is used to build the filename of the generated XML record. 

Beside the mode (`--mode g`, standing for generation) and the source (`-s FILE`, the path to the csv file) the following options are mandatory :
- ```-c COMMUNITY``` : a free choosen project or community name. Here and in the following modules we use examplarily the project name *fishproject*.
- ```--mdprefix MDFORMAT``` : This is for the mode *generation* the target metadata schema, we choose here *oai_dc*, i.e. the Dublincore metadata schema.

Optionally a subset and the delimiter of the original source file can be specified.
- ```--mdsubset MDSUBSET``` : The subset that determines the sub directory the generated XML files reside. Default is the subset `SET_1`, we choose here `sample`, resulting in the sub directory `sample_1` of the output path.
- ```--verb DELIMITER``` specifies here the delimiter by which the sample data are separated, by default (and in our example) set to *comma*.

From these parameters the name for the mapfile is built as ```mapfiles/<community>-<mdprefix>.csv``` and the output path is combined to ```oaidata/<community>-<mdprefix>/<mdsubset>_1```.  

By calling the script for the first time, there will be no mapfile available. So you are asked for each original header field to enter a valid DublinCore element or term :

```sh
./mdmanager.py --mode g -c fishproject -s samples/RAW_data/sample.csv --mdprefix oai_dc --mdsubset sample --verb comma
...
|- Generation started : 2016-10-18 17:51:34
 |- Original fields:
	['Common name', 'Scientific name', 'Location', 'Temperament', 'Diet', 'Water', 'Size', 'Region of the Aquarium', 'Breeding']
 |- Generate mapfile	mapfiles/fishproject-oai_dc.csv
Target field for Common name : dc:identifier
Target field for Scientific name : dc:title
Target field for Location : dcterms:spatial
Target field for Temperament : dc:type
Target field for Diet : dcterms:requires
Target field for Water : dcterms:medium
Target field for Size : dcterms:extent
Target field for Region of the Aquarium : dcterms:provenance
Target field for Breeding : dcterms:created
 |- Generate XML files in oaidata/fishproject-oai_dc/sample_1/xml
  |--> Compressiceps.xml
  |--> Frontosa.xml
  |--> GoldenJulie.xml
  |--> ConvictJulie.xml
  |--> PrincessCichlid.xml
  |--> Cylindricus.xml
  |--> Multi.xml
  |--> FiveBarCichlid.xml
```

This results not only in the newly generated mapping file ```fishproject-oai_dc.csv```, but as well the mapping is excecuted and the associated XML files are written to the output directory ```oaidata/fishproject-oai_dc/sample_1/xml/```.

> Note : Here starts the issue of semantic mapping and 
> homogenisation of a research specific vocabulary to a common, 
> restricted vocabulary or schema as DublinCore. I.e. the mapping above is quite "formal", e.g. `Diet` is mapped to `dcterms:requires`, but likely the intention of the DublinCore consortium by introducing the field `requires` was not in the sense of `a plant requires a specific diet`. So, if we want to cover these specific biological properties we have to add another extented shema, which covers the property `Diet`. 

### Excercise 2.1: Configure your own mapping

Repeat the generation and do your own mapping by adapting the mapping rules in the mapfile to your needs. Hereby the seperator ```>``` is used to seperate the original field name and the target Dublincore element or term :
```sh
$ vi mapfiles/fishproject-oai_dc.csv
Common name>dc:identifier
Scientific name>dc:title
Location>dcterms:spatial
Temperament>dc:type
Diet>dcterms:requires
Water>dcterms:medium
Size>dcterms:extent
Region of the Aquarium>dcterms:provenance
Breeding>dcterms:created
```
 
### Excercise 2.2: Check and validate XML file

Check the results, i.e. the generated XML files in the output directory ```oaidata/fishproject-oai_dc/sample_1/xml/```. E.g. with the above mapping one of the resulted files looks as follows:

```sh
less oaidata/fishproject-oai_dc/sample_1/xml/Compressiceps.xml
<?xml version="1.0"?>

<metadata
    xmlns="http://example.org/myapp/"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://purl.org/dc/elements/1.1/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:dcterms="http://purl.org/dc/terms/">

        <dc:identifier>Compressiceps</dc:identifier>
        <dc:title>Haplochromis compressiceps</dc:title>
        <dc:type>Territorial</dc:type>
        <dcterms:created>Hard</dcterms:created>
        <dcterms:extent>5 inches</dcterms:extent>
        <dcterms:medium>PH 7.0 - 8.0, Temp. 73 - 77 F</dcterms:medium>
        <dcterms:provenance>Bottom</dcterms:provenance>
        <dcterms:requires>Omnivore</dcterms:requires>
        <dcterms:spatial>Lake Tanganyika</dcterms:spatial>
</metadata>
```

You can check this e.g. by one of the available XML validators, e.g. ```http://www.xmlvalidation.com/```.

<!--
## Use a metadata editor
If you want generate detailed metadata for each singele dataset you can use a metadata editor to edit and add each field 'by hand'.

While there are a lot of online tools available, we describe here the GFZ metadata editor available at
```sh http://pmd.gfz-potsdam.de/panmetaworks/metaedit/```
-->

